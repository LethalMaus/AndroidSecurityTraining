<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!-- Optional: declare cross-user permissions for discussion (not granted to third-party apps) -->
    <uses-permission android:name="android.permission.INTERACT_ACROSS_USERS" tools:ignore="ProtectedPermissions" />
    <uses-permission android:name="android.permission.INTERACT_ACROSS_USERS_FULL" tools:ignore="ProtectedPermissions" />

    <application
        android:networkSecurityConfig="@xml/network_security_config_client_vuln"
        android:usesCleartextTraffic="true" >
            
        <!-- Make demo components dangerously accessible in vuln builds for training -->
        <service
            android:name=".perm.DemoService"
            tools:node="merge"
            tools:remove="android:permission"
            tools:replace="android:exported"
            android:exported="true"
            tools:ignore="ExportedService" />

        <!-- Explicitly exported demo service for adb startservice demo -->
        <service
            android:name=".ExportedService"
            android:exported="true"
            tools:ignore="ExportedService" />

        <provider
            android:name=".perm.DemoProvider"
            android:authorities="${applicationId}.demo"
            tools:replace="android:exported,android:readPermission,android:writePermission,android:grantUriPermissions,android:authorities"
            android:exported="true"
            android:readPermission=""
            android:writePermission=""
            android:grantUriPermissions="true"
            tools:ignore="ExportedContentProvider"/>

        <!-- Web topic receiver made dangerously exported in vuln builds -->
        <receiver
            android:name=".web.DemoReceiver"
            tools:replace="android:exported"
            android:exported="true"
            tools:ignore="ExportedReceiver">
            <intent-filter>
                <action android:name="dev.jamescullimore.android_security_training.web.DEMO" />
            </intent-filter>
            <intent-filter>
                <action android:name="dev.jamescullimore.android_security_training.web.LEAK_PI" />
            </intent-filter>
        </receiver>

        <!-- In vuln builds, expose the clear-data receiver for adb demos -->
        <receiver
            android:name=".ClearDataReceiver"
            tools:replace="android:exported,android:permission"
            android:exported="true"
            android:permission="">
            <intent-filter>
                <action android:name="dev.jamescullimore.android_security_training.ACTION_CLEAR_DATA" />
            </intent-filter>
        </receiver>
    </application>
</manifest>
